import{_ as p,c as r,J as s,m as e,a as i,V as c,o as l,E as a}from"./chunks/framework.WH0rnJL5.js";const h="/assets/image-20240205194735982.O3e-S0l9.png",g="/assets/image-20240205202219424.ITWxYWB2.png",m="/assets/image-20240205203157528.EbpC-Ocz.png",d="/assets/image-20240205203341408.Tm7iUnFp.png",k="/assets/image-20240205203638823.ioc6aYfm.png",_="/assets/image-20240205204001184.KkNa4GXE.png",u="/assets/image-20240205204113469.hwoy0K-x.png",b="/assets/image-20240205205023452.MbaFV32X.png",B="/assets/image-20240205205132280.ETJF3u6D.png",y="/assets/image-20240205205243607.HyB2uz1o.png",x="/assets/image-20240205205515277.MuCAx7N1.png",A="/assets/image-20240205205743290.KNIgoUtd.png",S="/assets/image-20240205210009980.2_4tZvsj.png",C="/assets/image-20240206164059084.OA4m7xsP.png",E="/assets/image-20240206164218957.aShpCIe8.png",f="/assets/image-20240206164333000.ofvFf34J.png",v="/assets/image-20240206164535759.MmxaYqIa.png",j="/assets/image-20240206164439682.vk-seE4o.png",D=JSON.parse('{"title":"Shiroååºåˆ—åŒ–æ¼æ´","description":"","frontmatter":{},"headers":[],"relativePath":"ç¬”è®°/ğŸ‘®ğŸ»ç½‘ç»œå®‰å…¨/Java/ååºåˆ—åŒ–/Shiro/Shiroååºåˆ—åŒ–æ¼æ´.md","filePath":"ç¬”è®°/ğŸ‘®ğŸ»ç½‘ç»œå®‰å…¨/Java/ååºåˆ—åŒ–/Shiro/Shiroååºåˆ—åŒ–æ¼æ´.md"}'),P={name:"ç¬”è®°/ğŸ‘®ğŸ»ç½‘ç»œå®‰å…¨/Java/ååºåˆ—åŒ–/Shiro/Shiroååºåˆ—åŒ–æ¼æ´.md"},F=e("h1",{id:"shiroååºåˆ—åŒ–æ¼æ´",tabindex:"-1"},[i("Shiroååºåˆ—åŒ–æ¼æ´ "),e("a",{class:"header-anchor",href:"#shiroååºåˆ—åŒ–æ¼æ´","aria-label":'Permalink to "Shiroååºåˆ—åŒ–æ¼æ´"'},"â€‹")],-1),I=c(`<h2 id="_0x01-å‰è¨€" tabindex="-1">0x01 å‰è¨€ <a class="header-anchor" href="#_0x01-å‰è¨€" aria-label="Permalink to &quot;0x01 å‰è¨€&quot;">â€‹</a></h2><p>Shiro-550ååºåˆ—åŒ–æ¼æ´å¤§çº¦åœ¨2016å¹´å°±è¢«æŠ«éœ²äº†ï¼Œä½†æ„Ÿè§‰ç›´åˆ°è¿‘ä¸€ä¸¤å¹´ï¼Œåœ¨å„ç§æ”»é˜²æ¼”ç»ƒä¸­è¿™ä¸ªæ¼æ´æ‰çœŸæ­£èµ°è¿›äº†å¤§å®¶çš„è§†é‡ï¼ŒShiro-550ååºåˆ—åŒ–åº”è¯¥å¯ä»¥ç®—æ˜¯è¿™ä¸€ä¸¤å¹´æœ€å¥½ç”¨çš„RCEæ¼æ´ä¹‹ä¸€ï¼ŒåŸå› æœ‰å¾ˆå¤šï¼šShiroæ¡†æ¶ä½¿ç”¨å¹¿æ³›ï¼Œæ¼æ´å½±å“èŒƒå›´å¹¿ï¼›æ”»å‡»payloadç»è¿‡AESåŠ å¯†ï¼Œå¾ˆå¤šå®‰å…¨é˜²æŠ¤è®¾å¤‡æ— æ³•è¯†åˆ«/æ‹¦æˆªæ”»å‡»â€¦â€¦</p><h2 id="_0x02-ç¯å¢ƒæ­å»º" tabindex="-1">0x02 ç¯å¢ƒæ­å»º <a class="header-anchor" href="#_0x02-ç¯å¢ƒæ­å»º" aria-label="Permalink to &quot;0x02 ç¯å¢ƒæ­å»º&quot;">â€‹</a></h2><p>ç›´æ¥ä»githubä¸Šcloneä»£ç åˆ°æœ¬åœ°ã€‚</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>git clone https://github.com/apache/shiro.git</span></span>
<span class="line"><span>cd shiro</span></span>
<span class="line"><span>git checkout shiro-root-1.2.4</span></span></code></pre></div><p>ç¼–è¾‘shiro/samples/webç›®å½•ä¸‹çš„pom.xml,å°†jstlçš„ç‰ˆæœ¬ä¿®æ”¹ä¸º1.2ã€‚</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;javax.servlet&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;jstl&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;1.2&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;runtime&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><h2 id="_0x03-æ¼æ´åˆ†æ" tabindex="-1">0x03 æ¼æ´åˆ†æ <a class="header-anchor" href="#_0x03-æ¼æ´åˆ†æ" aria-label="Permalink to &quot;0x03 æ¼æ´åˆ†æ&quot;">â€‹</a></h2><p>ç½‘ä¸Šçš„åˆ†ææ–‡ç« éƒ½ä¼šç›´æ¥å‘Šè¯‰æˆ‘ä»¬è§¦å‘ç‚¹åœ¨XXXï¼Œå¦‚æœå‚è€ƒæ–‡ç« ï¼Œé‚£æˆ‘ä»¬å¯èƒ½è¯´æ‰¾åˆ°è§¦å‘ç‚¹ï¼Œç„¶åå¾€ä¸‹è·Ÿå°±å®Œäº‹äº†ã€‚</p><p>è¿™æ ·çœ‹èµ·æ¥ä¼¼ä¹æˆ‘ä»¬å¥½åƒå­¦ä¹ åˆ°äº†ï¼Œä½†æ˜¯çœŸçš„äº†è§£è¿™ä¸ªæ´äº†å—ï¼Ÿæ‰€ä»¥ä¸å¦¨ä»å¦‚ä½•å‘ç°æ¥åˆ†æå‡ºè¿™ä¸ªæ¼æ´ã€‚</p><p>ç¬¬ä¸€ç§æ–¹å¼å°±åœ¨äºæˆ‘ä»¬å¯ä»¥æ ¹æ®æŠ¥é”™æ¥è¿›è¡Œåˆ†æï¼Œé¦–å…ˆå¦‚æœå¯¹ä¸rememberMeè¯¥å­—æ®µä¼ è¾“çš„å†…å®¹ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€äº›å¼‚å¸¸çš„é”™è¯¯ï¼Œä¼šå­˜åœ¨ä»¥ä¸‹å¼‚å¸¸</p><p><img src="`+h+'" alt="image-20240205194735982"></p><p>é‚£ä¹ˆæ ¹æ®è¿™ä¸ªæŠ¥é”™é“¾ï¼Œæˆ‘ä»¬éœ€è¦å®šä½åˆ°çš„å°±åœ¨äº<code>createSubject(SubjectContext subjectContext)</code>,ç„¶åå¾€ä¸‹è·Ÿè¸ªåŸºæœ¬ä¸Šå°±å¯ä»¥æ‰¾åˆ°è¯¥ååºåˆ—åŒ–é“¾çš„è§¦å‘ã€‚</p><h3 id="_3-1-åŠ å¯†è¿‡ç¨‹" tabindex="-1">3.1 åŠ å¯†è¿‡ç¨‹ <a class="header-anchor" href="#_3-1-åŠ å¯†è¿‡ç¨‹" aria-label="Permalink to &quot;3.1 åŠ å¯†è¿‡ç¨‹&quot;">â€‹</a></h3><p>é¦–å…ˆæ–­ç‚¹å¯ä»¥è®¾ç½®åœ¨<code>shiro/core/src/main/java/org/apache/shiro/subject/support/DelegatingSubject#login(AuthenticationToken token)</code></p><p><img src="'+g+'" alt="image-20240205202219424"></p><p>ç»§ç»­å¾€ä¸‹è·Ÿç€è°ƒç”¨ï¼Œåˆ°<code>shiro/core/src/main/java/org/apache/shiro/mgt/DefaultSecurityManager#login(Subject subject, AuthenticationToken token)</code></p><p><img src="'+m+'" alt="image-20240205203157528"></p><p>å¾€ä¸‹è°ƒç”¨åˆ°<code>onSuccessfulLogin(token, info, loggedIn);</code>,ç»§ç»­è·Ÿç€è°ƒç”¨å°±æ˜¯åˆ°åŒä¸€ä¸ªç±»ä¸‹çš„<code>onSuccessfulLogin(AuthenticationToken token, AuthenticationInfo info, Subject subject)</code>ä¸­ï¼Œç´§æ¥ç€è°ƒç”¨<code>rememberMeSuccessfulLogin(token, info, subject);</code>ä¸­ã€‚</p><p><img src="'+d+'" alt="image-20240205203341408"></p><p>æ ¹æ®ä¸Šè¿°ä»£ç ï¼Œé¦–å…ˆè·å–<code>CookieRememberMeManager</code>å¯¹è±¡ï¼Œå½“è¯¥ç±»ä¸ä¸ºç©ºï¼Œå¾€ä¸‹è°ƒç”¨<code>onSuccessfulLogin(subject, token, info);</code>ï¼Œè¯¥æ–¹æ³•ä¸»è¦çš„ä»£ç ä¸º</p><p><img src="'+k+'" alt="image-20240205203638823"></p><p>é€šè¿‡forgetIndentityæ–¹æ³•ï¼Œå¯¹subjectå¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œè¯¥å¯¹è±¡åŒ…å«å•ä¸ªç”¨æˆ·çš„çŠ¶æ€å’Œå®‰å…¨æ“ä½œï¼Œå…¶ä¸­åŒ…æ‹¬è®¤è¯ã€æˆæƒç­‰ç­‰ã€‚é‚£ä¹ˆæˆ‘ä»¬æœ‰å¿…è¦è·Ÿè¿›è¿™ä¸ªæ–¹æ³•åˆ†æå¤„ç†æ–¹å¼ã€‚</p><p>è·å–è¯·æ±‚åŒ…å’Œå“åº”åŒ…åï¼Œå†æ¬¡è°ƒç”¨forgetIndentityæ–¹æ³•ï¼Œå¤„ç†è¿™ä¸¤ä¸ªè·å–åˆ°çš„åŒ…ã€‚</p><p><img src="'+_+'" alt="image-20240205204001184"></p><p>é€šè¿‡getCookieæ–¹æ³•è·å–åˆ°cookieä¹‹åå†é€šè¿‡removeFromæ–¹æ³•ï¼Œåœ¨è¿”å›åŒ…ä¸­æ·»åŠ Set-Cookie: rememberMe=deleteMe</p><p><img src="'+u+'" alt="image-20240205204113469"></p><p>ç„¶åå›åˆ°onSuccessfulLoginæ–¹æ³•ä¸­ï¼Œå¦‚æœæœ‰è®¾ç½®rememberMeåˆ™è¿›å…¥rememberIdentityæ–¹æ³•ã€‚</p><p><img src="'+b+'" alt="image-20240205205023452"></p><p>é€šè¿‡è°ƒç”¨<code>convertPrincipalsToBytes</code>å¯¹ç”¨æˆ·åè¿›è¡Œå¤„ç†ï¼Œç„¶åè°ƒç”¨serializeå¯¹ç”¨æˆ·åè¿›è¡Œå¤„ç†ã€‚</p><p><img src="'+B+'" alt="image-20240205205132280"></p><p>ç„¶ååœ¨serializeæ–¹æ³•ä¸­ï¼Œå¯¹äºç”¨æˆ·åå†è¿›è¡Œå¤„ç†ã€‚</p><p><img src="'+y+'" alt="image-20240205205243607"></p><p>å›åˆ°<code>convertPrincipalsToBytes</code>æ–¹æ³•ä¸­ï¼Œå†å¯¹åºåˆ—åŒ–çš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚è·Ÿè¿›<code>encrypt(byte[] serialized)</code>ä¸­ï¼Œé€šè¿‡åŠ å¯†ç®—æ³•ä¸ºAESï¼Œæ¨¡å¼ä¸ºCBCï¼Œå¡«å……ç®—æ³•ä¸ºPKCS5Padding</p><p><img src="'+x+'" alt="image-20240205205515277"></p><p>é€šè¿‡<code> getEncryptionCipherKey()</code>è·å–åŠ å¯†å¯†é’¥ï¼Œè¯¥å¯†é’¥å¯ä»¥åœ¨<code>AbstractRememberMeManager.java</code>æ–‡ä»¶ä¸­çœ‹åˆ°ã€‚</p><p><img src="'+A+'" alt="image-20240205205743290"></p><p>è¿”å›åˆ°rememberIdentityæ–¹æ³•ä¸­ï¼Œè·Ÿè¿›rememberSerializedIdentityæ–¹æ³•ä¸­ï¼Œç„¶åå°†åŠ å¯†åçš„å†…å®¹è¿›è¡Œbase64åŠ å¯†ç„¶åè®¾ç½®åˆ°cookieä¸­ã€‚</p><p><img src="'+S+'" alt="image-20240205210009980"></p><p>ç„¶åå°±ç»“æŸäº†ã€‚</p><h3 id="_3-2-è§£å¯†è¿‡ç¨‹" tabindex="-1">3.2 è§£å¯†è¿‡ç¨‹ <a class="header-anchor" href="#_3-2-è§£å¯†è¿‡ç¨‹" aria-label="Permalink to &quot;3.2 è§£å¯†è¿‡ç¨‹&quot;">â€‹</a></h3><p>æ–­ç‚¹å¯ä»¥è®¾ç½®åœ¨<code>shiro/core/src/main/java/org/apache/shiro/mgt/AbstractRememberMeManager#getRememberedPrincipals(SubjectContext subjectContext)</code>ä¸­</p><p><img src="'+C+'" alt="image-20240206164059084"></p><p>é¦–å…ˆé€šè¿‡<code>getRememberedSerializedIdentity</code>æ–¹æ³•è·å–è§£ç ä¹‹åçš„å€¼</p><p><img src="'+E+'" alt="image-20240206164218957"></p><p>è·å–å¯†é’¥å¹¶ä¸”åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºè°ƒç”¨è§£å¯†å‡½æ•°ï¼Œå¯¹åŠ å¯†åçš„å†…å®¹è¿›è¡Œå¤„ç†ã€‚</p><p><img src="'+f+'" alt="image-20240206164333000"></p><p>ç„¶åè°ƒç”¨ååºåˆ—åŒ–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ååºåˆ—åŒ–æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„ï¼Œé‡å†™äº†ObjectInputStream</p><p><img src="'+v+'" alt="image-20240206164535759"></p><p>è°ƒç”¨readObjectä¹Ÿä¼šè¿›å…¥resolveClassæ–¹æ³•ã€‚</p><p><img src="'+j+'" alt="image-20240206164439682"></p><h2 id="è´¡çŒ®è€…" tabindex="-1">è´¡çŒ®è€… <a class="header-anchor" href="#è´¡çŒ®è€…" aria-label="Permalink to &quot;è´¡çŒ®è€…&quot;">â€‹</a></h2>',52),M=e("h2",{id:"æ–‡ä»¶å†å²",tabindex:"-1"},[i("æ–‡ä»¶å†å² "),e("a",{class:"header-anchor",href:"#æ–‡ä»¶å†å²","aria-label":'Permalink to "æ–‡ä»¶å†å²"'},"â€‹")],-1);function N(T,q,V,z,J,R){const t=a("NolebasePageProperties"),n=a("NolebaseGitContributors"),o=a("NolebaseGitChangelog");return l(),r("div",null,[F,s(t),I,s(n),M,s(o)])}const G=p(P,[["render",N]]);export{D as __pageData,G as default};
